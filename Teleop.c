#pragma config(Hubs,  S1, HTMotor,  HTMotor,  HTMotor,  none)
#pragma config(Sensor, S1,     ,               sensorI2CMuxController)
#pragma config(Motor,  mtr_S1_C1_1,     leftBack,      tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C1_2,     rightBack,     tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C2_1,     lift,          tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C2_2,     scoop,         tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C3_1,     leftFront,     tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S1_C3_2,     rightFront,    tmotorTetrix, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//


#include "library.c"

// The RobotC naming. SUCKS. Fix this.

// Joystick naming. Fix the order. Thank you.
#define driver1LeftStickX joystick.joy1_x1
#define driver1LeftStickY joystick.joy1_y1
#define driver1RightStickX joystick.joy1_x2
#define driver1RightStickY joystick.joy1_y2

#define driver2LeftStickX joystick.joy2_x1
#define driver2LeftStickY joystick.joy2_y1
#define driver2RightStickX joystick.joy2_x2
#define driver2RightStickY joystick.joy2_y2

// Button naming. Actual names. Thank you.
#define driver1btnA joy1Btn(2)
#define driver1btnB joy1Btn(3)
#define driver1btnX joy1Btn(1)
#define driver1btnY joy1Btn(4)
#define driver1btnL2 joy1Btn(7)
#define driver1btnR2 joy1Btn(8)

#define driver2btnA joy2Btn(2)
#define driver2btnB joy2Btn(3)
#define driver2btnX joy2Btn(1)
#define driver2btnY joy2Btn(4)
#define driver2btnL2 joy2Btn(8)
#define driver2btnR2 joy2Btn(8)


// Teleop-only "library" functions

// Exponential function to map to the joystickValue
int joystickToMotor(int joystickValue)
{

	int motorValue;
	const int minimumValue = 4; // This value high = less control, less whining; this value low = more fine control, more whining, more magic blue smoke (out of 100)
	const int joystickZero = 5; // Joysticks are very sensitive; it may be a bit off zero when they're not trying to move anything anyway (out of 127)
	if (abs(joystickValue) < joystickZero)
	{
		motorValue = 0;
	}
	else
	{
		// We will play the piccolo
		motorValue = ((pow(1.05, abs(joystickValue)) - 1) / (490.954203 - minimumValue) / 100 + minimumValue) * (joystickValue < 0 ? -1 : 1); // That constant is 1.05^127
	}
	return motorValue;

}

// Reads
int motorModifiers(int motorValue)
{

	//

}


task main()
{

	// Programwide variables
	int emergencyShutdown = false;

	// Servo initialization

	waitForStart();

	while (true)
	{

		getJoystickSettings(joystick);

		// Each loop cycle code goes here (eg joystick driving)

		/* Joystick: Driving layout
		 * Analog sticks: Tankdrive
		 * Arrow up/down: Lift control
		 * Buttons for Scoop
		 */

		/* Joystick: Lift layout
		 * Analog stick 1: Lift
		 * Analog stick 2: Scoop
		 */

		/* Both Joysticks:
		 * Button A for emergency shutdown
		 * R2 for half-speed everything
		 */

		// Tank Drive
		setLeft(joystickToMotor(driver1LeftStickY));
		setRight(joystickToMotor(driver1RightStickY));

	}

	return;

}
