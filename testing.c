#pragma config(Sensor, S1,     HTIRS,          sensorI2CCustom)
#pragma config(Motor,  motorA,          right,         tmotorNXT, PIDControl, encoder)
#pragma config(Motor,  motorB,          left,          tmotorNXT, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

//#include "library.c"
#include "C:\Program Files (x86)\Robomatter Inc\ROBOTC Development Environment 4.X\Sample Programs\NXT\3rdPartyDriverLibrary\include\hitechnic-irseeker-v2.h"

task main()
{

	const int maxSpeed = 80;

	bool wentForwardAlready = false;

	motor[left] = maxSpeed;
	motor[right] = maxSpeed;

  displayTextLine(3, "lol: %2d", motor[left]);
  displayTextLine(4, "ror: %3d", motor[right]);

	wait1Msec(1000);

	motor[left] = 0;
	motor[right] = 0;

  while(true)
  {

		int ir[8];

    HTIRS2readAllDCStrength(HTIRS, ir[1], ir[2], ir[3], ir[4], ir[5]);

    int direction = HTIRS2readDCDir(HTIRS);

    int flipLeft  = ((direction < 5) ? -1 : 1);
    int flipRight = ((direction > 5) ? -1 : 1);
		motor[left] = maxSpeed * flipLeft;
		motor[right] = maxSpeed * flipRight;

		if (direction == 0)
		{
			if (!wentForwardAlready)
			{
				motor[left] = maxSpeed;
				motor[right] = maxSpeed;
				Wait1Msec(500);
				wentForwardAlready = true;
			}
			else
			{
				motor[left] = maxSpeed;
				motor[right] = -1 * maxSpeed;
			}
		}
		else
		{
			wentForwardAlready = false;
		}

    eraseDisplay();
    displayTextLine(0,"HT IR Seeker");
    displayTextLine(2, "dir: %3d", direction);
    displayTextLine(3, "ir1: %3d", ir[1]);
    displayTextLine(4, "ir2: %3d", ir[2]);
    displayTextLine(5, "ir3: %3d", ir[3]);
    displayTextLine(6, "ir4: %3d", ir[4]);
    displayTextLine(7, "ir5: %3d", ir[5]);

  }
}
